<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li aria-current="page" class="breadcrumb-item active">Scheda presenze</li>
    </ol>
</nav>
<div class="row">
    <div class="col-xxxl-12">
        <mat-card class="trinta-card mb-15 bg-white border-none d-block months">
            <mat-card-content>
                <div class="calendar-header d-flex align-items-center justify-content-between">

                    <div class="d-flex align-items-center moth">
                        <button mat-icon-button class="nav-btn" (click)="previousMonth()" aria-label="Mese precedente">
                            <mat-icon>chevron_left</mat-icon>
                        </button>

                        <h4 class="month-title mb-0">
                            {{ currentMonthName | titlecase }} {{ currentYear }}
                        </h4>

                        <button mat-icon-button class="nav-btn" (click)="nextMonth()" aria-label="Mese successivo">
                            <mat-icon>chevron_right</mat-icon>
                        </button>
                    </div>

                    <button mat-button class="export-btn" type="button" (click)="generateExcel()">
                        Download file
                    </button>

                </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>
<div class="row">
    <div class="col-xxxl-12">
        <mat-card class="trinta-card mb-25 bg-white border-none d-block">
            <mat-card-content>
              <div class="mini-calendar-container">
                <table class="table table-bordered mini-calendar">
                    <thead>
                    <tr>
                        <th>Operatore</th>
                        <th *ngFor="let day of monthDays">{{ day }}</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let op of operators">
                            <td class="operator-cell">{{ op.fullName }}</td>
                            <td *ngFor="let day of monthDays">

                                <!-- Weekend o festivo -->
                                <ng-container *ngIf="isWeekendOrHoliday(day); else workingDay">
                                    <div 
                                        class="event-cell non-working"
                                        matTooltip="Giorno non lavorativo"
                                        matTooltipPosition="above">
                                    </div>
                                </ng-container>

                                <!-- Giorno lavorativo -->
                                <ng-template #workingDay>
                                    <ng-container *ngIf="getEventsForDay(op.events, day) as events">

                                        <div 
                                            class="event-cell"
                                            [ngClass]="getCellClasses(events)"
                                            [matTooltip]="getTooltipForDay(op.events, day)"
                                            matTooltipPosition="above"
                                        >
                                            <!-- Presenza -->
                                            <ng-container *ngIf="getPresence(events) as pres">
                                                {{ formatHourMinute(pres.startHour) || '-' }}<br>
                                                {{ formatHourMinute(pres.endHour) || '-' }}
                                            </ng-container>

                                            <!-- Permesso -->
                                            <div *ngIf="hasPermission(events)">P</div>

                                            <!-- Ferie -->
                                            <div *ngIf="hasVacation(events)">F</div>

                                            <!-- Malattia -->
                                            <div *ngIf="hasIllness(events)">M</div>
                                        </div>

                                    </ng-container>
                                </ng-template>

                            </td>
                        </tr>
                    </tbody>
                </table>
              </div>
            </mat-card-content>
        </mat-card>
    </div>
</div>    