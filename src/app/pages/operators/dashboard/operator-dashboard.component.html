<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item active" aria-current="page">Presenza di oggi</li>
  </ol>
</nav>

<div class="dashboard-grid">

  <!-- ===== PRIMA DELL'ENTRATA ===== -->
  <mat-card class="card-entry" *ngIf="!attendance" @fadeIn>
    <h2>Conferma Presenza</h2>
    <div class="card-body">
      <p><i-feather name="Clock"></i-feather> Orario: {{ entryTime }}</p>
      <textarea [(ngModel)]="notes" placeholder="Note"></textarea>
      <button mat-raised-button color="primary" (click)="confirmEntry()">
       Conferma Entrata
      </button>
    </div>
  </mat-card>

  <!-- ===== GIORNATA ATTIVA ===== -->
  <ng-container *ngIf="attendance && !attendance.exitTime">
    <mat-card class="card-timer" @fadeIn>
      <h2>Tempo Lavorato</h2>
      <h1>{{ liveTimer }}</h1>
    </mat-card>

    <mat-card class="card-break" *ngIf="!hasActiveBreak()" @fadeIn>
      <button mat-raised-button color="accent" (click)="startBreak()">
        <i-feather name="Coffee"></i-feather> Inizia Pausa
      </button>
    </mat-card>

    <mat-card class="card-break" *ngIf="hasActiveBreak()" @fadeIn>
      <h3>Pausa in corso</h3>
      <h1>{{ breakTimer }}</h1>
      <button mat-raised-button color="primary" (click)="endBreak()">
        <i-feather name="Coffee"></i-feather> Termina Pausa
      </button>
    </mat-card>

    <mat-card class="card-exit" @fadeIn>
      <button mat-raised-button color="warn" (click)="confirmExit()">
        <i-feather name="LogOut"></i-feather> Chiudi Giornata
      </button>
    </mat-card>
  </ng-container>

  <!-- ===== RIEPILOGO ===== -->
  <mat-card class="card-summary" *ngIf="attendance?.exitTime" @fadeIn>
    <div class="summary-card">
      <div class="summary-header">
          <i-feather name="check-circle" class="summary-icon"></i-feather>
          <h2>Riepilogo giornata</h2>
      </div>

      <div class="summary-content">

          <!-- ENTRATA -->
          <div class="summary-row">
              <span class="label">Entrata</span>
              <span class="value">{{ attendance!.entryTime }}</span>
          </div>

          <!-- PAUSE -->
          <div class="summary-row" *ngFor="let b of attendance!.breaks">
              <span class="label">Pausa</span>
              <span class="value"> {{ b.start }} - {{ b.end || 'In corso' }}</span>
          </div>

          <!-- USCITA -->
          <div class="summary-row">
              <span class="label">Uscita</span>
              <span class="value">{{ attendance!.exitTime }}</span>
          </div>

          <!-- DURATA PAUSE -->
          <div class="summary-row total">
              <span class="label">Durata pause</span>
              <span class="value">
                  {{ calculateTotalBreakDuration() }}
              </span>
          </div>

          <!-- TOTALE ORE LAVORATE -->
          <div class="summary-row total">
              <span class="label">Totale ore lavorate</span>
              <span class="value">
                  {{ calculateWorkedTime() }}
              </span>
          </div>

          <!-- NOTE -->
          <div class="summary-row notes" *ngIf="attendance?.notes">
              <span class="label">Note</span>
              <p class="note-text">{{ attendance?.notes }}</p>
          </div>

      </div>
    </div>
  </mat-card>

</div>
