<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li aria-current="page" class="breadcrumb-item active">Ordini</li>
  </ol>
</nav>

<mat-card class="trinta-card to-do-list-card mb-10 bg-white border-none d-block filters">
  <mat-card-content>
    <div class="filter-panel">
      <input type="checkbox" id="toggleFilter" class="toggle-checkbox">
      <label for="toggleFilter" class="toggle-label">
        Filtri ordini <span class="arrow">&#9660;</span>
      </label>

      <div class="filter-content">
          <form [formGroup]="form">
            <div class="container">
                <div class="row">
                    <div class="col-lg-2">
                        <mat-form-field>
                            <i-feather name="users"></i-feather>
                            <mat-label>Filtra per cliente</mat-label>
                            <mat-select formControlName="customerId">
                                <mat-option *ngFor="let option of customers" [value]="option._id">
                                {{ option.businessName }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>                        
                    </div>
                    <div class="col-lg-2" *ngIf="!IsOperatorView">
                        <mat-form-field>
                            <i-feather name="users"></i-feather>
                            <mat-label>Filtra per operatore</mat-label>
                            <mat-select formControlName="operatorId">
                                <mat-option *ngFor="let option of operators" [value]="option._id">
                                {{ option.businessName }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>                        
                    </div>
                    <div class="col-lg-2">
                        <mat-form-field>
                            <i-feather name="bar-chart-2"></i-feather>
                            <mat-label>Stato</mat-label>
                            <mat-select formControlName="status">
                                <mat-option *ngFor="let option of orderState" [value]="option._id">
                                  {{ option.name }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>                        
                    </div>
                    <div class="col-lg-3">
                      <mat-form-field appearance="fill">
                        <i-feather name="calendar"></i-feather>
                        <mat-label>Seleziona intervallo</mat-label>
                        <div formGroupName="dateRange">
                          <mat-date-range-input [rangePicker]="picker">
                            <input matStartDate formControlName="start" placeholder="Da">
                            <input matEndDate formControlName="end" placeholder="A">
                          </mat-date-range-input>
                        </div>
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                      </mat-form-field>
                    </div>
                    <div class="col-lg-2">
                          <button mat-button class="filter" type="submit" (click)="onSubmit()">
                            Filtra
                        </button>               
                    </div>
                    <div class="col-lg-2">
                        <button mat-button class="remove" type="submit" (click)="remove()">
                          Rimuovi
                      </button>               
                    </div>
                </div>
            </div>
        </form>
      </div>
    </div>
  </mat-card-content>
</mat-card>
<mat-card class="trinta-card to-do-list-card mb-25 bg-white border-none d-block">
  <mat-card-content>
    <div class="to-do-list-table">
      <div class="table-responsive">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>

        <!-- Cliente -->
        <ng-container matColumnDef="shippingBusinessName">
          <th mat-header-cell *matHeaderCellDef> Cliente </th>
          <td mat-cell *matCellDef="let element" data-label="Cliente">
            {{element.shippingBusinessName}}
          </td>
        </ng-container>

        <!-- Operatore -->
        <ng-container matColumnDef="operatorId">
          <th mat-header-cell *matHeaderCellDef> Operatore </th>
          <td mat-cell *matCellDef="let element" data-label="Operatore">
            {{element.operatorId?.businessName || ''}}
          </td>
        </ng-container>

        <!-- Prodotti -->
        <ng-container matColumnDef="orderProducts">
          <th mat-header-cell *matHeaderCellDef> Prodotti </th>
          <td mat-cell *matCellDef="let element" data-label="Prodotti">
            <div *ngFor="let p of getMainProducts(element.orderProducts)">
              {{ p.name }} (x{{ p.quantity }})
            </div>
          </td>
        </ng-container>

        <!-- Data -->
        <ng-container matColumnDef="insertDate">
          <th mat-header-cell *matHeaderCellDef> Data </th>
          <td mat-cell *matCellDef="let element" data-label="Data">
            {{ element.insertDate | date:'dd/MM/yyyy'}}
          </td>
        </ng-container>

        <!-- Data consegna-->
        <ng-container matColumnDef="expectedDelivery">
          <th mat-header-cell *matHeaderCellDef> Consegna prevista </th>
          <td mat-cell *matCellDef="let element" data-label="Consegna prevista">
            {{ element.expectedDelivery | date:'dd/MM/yyyy'}}
          </td>
        </ng-container>

        <!-- Stato -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef> Stato </th>
          <td mat-cell *matCellDef="let element" data-label="Stato">
            {{ element.status.name }}
          </td>
        </ng-container>

        <ng-container matColumnDef="downloadOperator">
            <th mat-header-cell *matHeaderCellDef class="text-center pr-0">
                Documento
            </th>
            <td mat-cell *matCellDef="let element" class="text-center pr-0" data-label="Scarica documento">
                <div class="action">
                    <button type="button" mat-button class="p-0 min-w-auto lh-1 h-auto" matTooltip="scarica documento" (click)="DownloadDocOperator(element)">
                        <i class="ri-file-download-line"></i>
                    </button>
                </div>
            </td>
        </ng-container>
        <ng-container matColumnDef="edit">
            <th mat-header-cell *matHeaderCellDef class="text-center pr-0 mini">
                Modifica
            </th>
            <td mat-cell *matCellDef="let element" class="text-center pr-0" data-label="Modifica ordine">
                <div class="action">
                    <button type="button" mat-button class="p-0 min-w-auto lh-1 h-auto" matTooltip="modifica ordine"  (click)="UpdateOrder(element)">
                        <i class="{{element.action.edit}}"></i>
                    </button>
                </div>
            </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      </div>
      <div class="progress">
          <mat-progress-bar *ngIf="firstLoading" mode="indeterminate"></mat-progress-bar>
      </div>
      <mat-paginator  
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageSizeOptions]="[20, 50, 100, 200, 500, 1000, 2000]"
        showFirstLastButtons>
      </mat-paginator>
    </div>

  </mat-card-content>
</mat-card>
